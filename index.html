<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário Multistep - Cálculo de Custos</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #2ecc71;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .steps {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background-color: var(--light-color);
        }
        
        .step {
            text-align: center;
            flex: 1;
            position: relative;
        }
        
        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #bdc3c7;
            z-index: 1;
        }
        
        .step.active:not(:last-child)::after {
            background-color: var(--secondary-color);
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #bdc3c7;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            z-index: 2;
        }
        
        .step.active .step-circle {
            background-color: var(--secondary-color);
        }
        
        .step.completed .step-circle {
            background-color: var(--success-color);
        }
        
        .step-label {
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-container {
            padding: 30px;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        input:read-only {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-prev {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-next, .btn-submit {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-prev:hover {
            background-color: #7f8c8d;
        }
        
        .btn-next:hover, .btn-submit:hover {
            background-color: #2980b9;
        }
        
        .btn-submit {
            background-color: var(--success-color);
        }
        
        .btn-submit:hover {
            background-color: #27ae60;
        }
        
        .currency-input {
            position: relative;
        }
        
        .currency-input::before {
            content: 'R$';
            position: absolute;
            left: 12px;
            top: 12px;
            color: #6c757d;
        }
        
        .currency-input input {
            padding-left: 40px;
        }
        
        .separator {
            height: 1px;
            background-color: #ddd;
            margin: 30px 0;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-bold {
            font-weight: 700;
        }
        
        .text-uppercase {
            text-transform: uppercase;
        }
        
        .contact-info {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        .result-field {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: var(--secondary-color);
        }
        
        .loading.spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            color: var(--accent-color);
            font-size: 14px;
            margin-top: 5px;
        }
        
        .pdf-loading {
            display: none;
            text-align: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            margin: 10px 0;
        }
        
        .currency-display {
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .steps {
                flex-direction: column;
                gap: 15px;
            }
            
            .step:not(:last-child)::after {
                display: none;
            }
            
            .buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cálculo de Custos de Construção</h1>
            <p>Preencha as informações abaixo para calcular os custos da sua obra</p>
        </div>
        
        <div class="steps">
            <div class="step active" id="step1-indicator">
                <div class="step-circle">1</div>
                <div class="step-label">Informações Básicas</div>
            </div>
            <div class="step" id="step2-indicator">
                <div class="step-circle">2</div>
                <div class="step-label">Áreas</div>
            </div>
            <div class="step" id="step3-indicator">
                <div class="step-circle">3</div>
                <div class="step-label">Custos</div>
            </div>
            <div class="step" id="step4-indicator">
                <div class="step-circle">4</div>
                <div class="step-label">Fator de Ajuste</div>
            </div>
        </div>
        
        <form id="multistep-form">
            <div class="form-container">
                <!-- Passo 1: Informações Básicas -->
                <div class="form-step active" id="step1">
                    <div class="form-group">
                        <label for="destinacao">Destinação *</label>
                        <select id="destinacao" name="destinacao" required>
                            <option value="">Selecione uma opção</option>
                            <option value="Unifamiliar">Unifamiliar</option>
                            <option value="Multifamiliar">Multifamiliar</option>
                            <option value="Comercial Salas e Lojas">Comercial Salas e Lojas</option>
                            <option value="Galpão Industrial">Galpão Industrial</option>
                            <option value="Conjunto Habitacional Popular">Conjunto Habitacional Popular</option>
                            <option value="Casa Popular">Casa Popular</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="metodo-construtivo">Método Construtivo *</label>
                        <select id="metodo-construtivo" name="metodo-construtivo" required>
                            <option value="">Selecione uma opção</option>
                            <option value="Alvenaria">Alvenaria</option>
                            <option value="Mista/Madeira">Mista/Madeira</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="estado">Estado *</label>
                        <select id="estado" name="estado" required>
                            <option value="">Selecione um estado</option>
                            <!-- Estados serão preenchidos via JavaScript -->
                        </select>
                    </div>
                    
                    <div class="buttons">
                        <div></div>
                        <button type="button" class="btn-next" id="next1">Próximo</button>
                    </div>
                </div>
                
                <!-- Passo 2: Áreas -->
                <div class="form-step" id="step2">
                    <div class="form-group">
                        <label for="area-principal">Área Construída Principal (m²) *</label>
                        <input type="number" id="area-principal" name="area-principal" step="0.01" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="area-complementar-coberta">Área Construída Complementar Coberta (m²)</label>
                        <input type="number" id="area-complementar-coberta" name="area-complementar-coberta" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="area-complementar-descoberta">Área Construída Complementar Descoberta (m²)</label>
                        <input type="number" id="area-complementar-descoberta" name="area-complementar-descoberta" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="area-total">Área Construída Total (m²)</label>
                        <input type="number" id="area-total" name="area-total" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="percentual-equivalencia">Percentual de Equivalência</label>
                        <input type="text" id="percentual-equivalencia" name="percentual-equivalencia" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="area-equivalente">Área Equivalente (m²)</label>
                        <input type="number" id="area-equivalent" name="area-equivalente" readonly>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" class="btn-prev" id="prev2">Anterior</button>
                        <button type="button" class="btn-next" id="next2">Próximo</button>
                    </div>
                </div>
                
                <!-- Passo 3: Custos -->
                <div class="form-step" id="step3">
                    <div class="form-group">
                        <label for="vau">VAU (R$) *</label>
                        <div class="currency-input">
                            <input type="number" id="vau" name="vau" step="0.01" min="0" required placeholder="Digite o valor do VAU">
                        </div>
                        <small>Preencha com o valor do VAU conforme tabela de referência</small>
                        <a href="https://calculadoradeinss.netlify.app/tabelavau.html" target="_blank" rel="noopener noreferrer">Acesse a tabela VAU</a>
                    </div>
                    
                    <div class="form-group">
                        <label for="custo-destinacao">Custo por Destinação (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="custo-destinacao" name="custo-destinacao" readonly class="currency-display">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="fator-social">Fator Social</label>
                        <input type="text" id="fator-social" name="fator-social" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="pmo">PMO (Percentual de Mão de Obra sobre o Custo da Obra)</label>
                        <input type="text" id="pmo" name="pmo" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="remuneracao-mao-obra">Remuneração de Mão de Obra Total (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="remuneracao-mao-obra" name="remuneracao-mao-obra" readonly class="currency-display">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="inss-recolher">INSS a Recolher (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="inss-recolher" name="inss-recolher" readonly class="currency-display">
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" class="btn-prev" id="prev3">Anterior</button>
                        <button type="button" class="btn-next" id="next3">Próximo</button>
                    </div>
                </div>
                
                <!-- Passo 4: Fator de Ajuste -->
                <div class="form-step" id="step4">
                    <div class="text-center">
                        <h2 class="text-bold">Fator de Ajuste</h2>
                    </div>
                    
                    <div class="form-group">
                        <label for="remuneracao-mao-obra-display">Remuneração de Mão de Obra Total (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="remuneracao-mao-obra-display" name="remuneracao-mao-obra-display" readonly class="currency-display">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="fator-ajuste-percentual">Fator de Ajuste (%)</label>
                        <input type="text" id="fator-ajuste-percentual" name="fator-ajuste-percentual" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="rmt-fa">RMT Para o FA (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="rmt-fa" name="rmt-fa" readonly class="currency-display">
                        </div>
                    </div>
                    
                    <div class="separator"></div>
                    
                    <div class="text-center">
                        <h3 class="text-uppercase">Aplicação do Fator de Ajuste</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="fator-ajuste-valor">Fator de Ajuste (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="fator-ajuste-valor" name="fator-ajuste-valor" readonly class="currency-display">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rmt-fa-display">RMT para o FA (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="rmt-fa-display" name="rmt-fa-display" readonly class="currency-display">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cpp">Contribuição Patronal Previdenciária (CPP) (R$)</label>
                        <div class="currency-input">
                            <input type="text" id="cpp" name="cpp" readonly class="currency-display">
                        </div>
                    </div>

                    <div class="pdf-loading" id="pdf-loading">
                        <div class="spinner"></div>
                        <p>Gerando PDF, aguarde...</p>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" class="btn-prev" id="prev4">Anterior</button>
                        <button type="button" class="btn-submit" id="generate-pdf">Gerar PDF</button>
                    </div>
                </div>
            </div>
        </form>
        
        <div class="contact-info">
            <p>E-mail: contatoinssobra@gmail.com | Tel: (35) 99911-9922</p>
        </div>
    </div>

    <script>
        // Estados brasileiros
        const estados = [
            "AC", "AL", "AP", "AM", "BA", "CE", "DF", "ES", "GO", "MA", 
            "MT", "MS", "MG", "PA", "PB", "PR", "PE", "PI", "RJ", "RN", 
            "RS", "RO", "RR", "SC", "SP", "SE", "TO"
        ];
        
        // Preencher o select de estados
        const estadoSelect = document.getElementById('estado');
        estados.forEach(estado => {
            const option = document.createElement('option');
            option.value = estado;
            option.textContent = estado;
            estadoSelect.appendChild(option);
        });
        
        // Navegação entre passos
        const steps = document.querySelectorAll('.form-step');
        const stepIndicators = document.querySelectorAll('.step');
        let currentStep = 0;
        
        // Botões de navegação
        document.getElementById('next1').addEventListener('click', () => navigateToStep(1));
        document.getElementById('prev2').addEventListener('click', () => navigateToStep(0));
        document.getElementById('next2').addEventListener('click', () => navigateToStep(2));
        document.getElementById('prev3').addEventListener('click', () => navigateToStep(1));
        document.getElementById('next3').addEventListener('click', () => navigateToStep(3));
        document.getElementById('prev4').addEventListener('click', () => navigateToStep(2));
        
        // Função para formatar valores em Real brasileiro
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value || 0);
        }
        
        // Função para aplicar formatação aos campos de moeda
        function updateCurrencyDisplay(inputId, value) {
            const input = document.getElementById(inputId);
            if (input) {
                input.value = formatCurrency(value);
            }
        }
        
        function navigateToStep(stepIndex) {
            // Validação antes de avançar
            if (stepIndex > currentStep) {
                if (!validateStep(currentStep)) {
                    return;
                }
                
                // Calcular áreas se estamos indo para o passo 2
                if (stepIndex === 1) {
                    calculateAreas();
                }
                
                // Calcular custos se estamos indo para o passo 3
                if (stepIndex === 2) {
                    calculateCosts();
                }
                
                // Calcular fator de ajuste se estamos indo para o passo 4
                if (stepIndex === 3) {
                    calculateAdjustmentFactor();
                }
            }
            
            // Atualizar a exibição dos passos
            steps.forEach((step, index) => {
                if (index === stepIndex) {
                    step.classList.add('active');
                    stepIndicators[index].classList.add('active');
                } else {
                    step.classList.remove('active');
                    stepIndicators[index].classList.remove('active');
                }
            });
            
            // Marcar passos anteriores como completos
            for (let i = 0; i < stepIndex; i++) {
                stepIndicators[i].classList.add('completed');
            }
            
            currentStep = stepIndex;
        }
        
        function validateStep(stepIndex) {
            const currentStepElement = steps[stepIndex];
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (!field.value) {
                    alert(`Por favor, preencha o campo: ${field.previousElementSibling.textContent}`);
                    field.focus();
                    return false;
                }
            }
            
            return true;
        }
        
        // Cálculo de áreas (Passo 2)
        function calculateAreas() {
            const areaPrincipal = parseFloat(document.getElementById('area-principal').value) || 0;
            const areaCoberta = parseFloat(document.getElementById('area-complementar-coberta').value) || 0;
            const areaDescoberta = parseFloat(document.getElementById('area-complementar-descoberta').value) || 0;
            
            // Calcular área total
            const areaTotal = areaPrincipal + areaCoberta + areaDescoberta;
            document.getElementById('area-total').value = areaTotal.toFixed(2);
            
            // Calcular percentual de equivalência
            const destinacao = document.getElementById('destinacao').value;
            let percentualEquivalencia = 0;
            
            switch(destinacao) {
                case 'Unifamiliar':
                    percentualEquivalencia = areaTotal <= 1000 ? 89 : 85;
                    break;
                case 'Multifamiliar':
                    percentualEquivalencia = areaTotal <= 1000 ? 90 : 86.5;
                    break;
                case 'Comercial Salas e Lojas':
                    percentualEquivalencia = areaTotal <= 3000 ? 86 : 83;
                    break;
                case 'Galpão Industrial':
                    percentualEquivalencia = 95;
                    break;
                case 'Conjunto Habitacional Popular':
                case 'Casa Popular':
                    percentualEquivalencia = 98;
                    break;
            }
            
            document.getElementById('percentual-equivalencia').value = `${percentualEquivalencia}%`;
            
            // Calcular área equivalente
            const areaEquivalente = areaTotal * (percentualEquivalencia / 100);
            document.getElementById('area-equivalent').value = areaEquivalente.toFixed(2);
        }
        
        // Event listeners para cálculo automático de áreas
        document.getElementById('area-principal').addEventListener('input', calculateAreas);
        document.getElementById('area-complementar-coberta').addEventListener('input', calculateAreas);
        document.getElementById('area-complementar-descoberta').addEventListener('input', calculateAreas);
        
        // Cálculo de custos (Passo 3)
        function calculateCosts() {
            const vau = parseFloat(document.getElementById('vau').value) || 0;
            const areaEquivalente = parseFloat(document.getElementById('area-equivalent').value) || 0;
            const areaTotal = parseFloat(document.getElementById('area-total').value) || 0;
            const destinacao = document.getElementById('destinacao').value;
            const metodoConstrutivo = document.getElementById('metodo-construtivo').value;
            
            // Calcular custo por destinação
            const custoDestinacao = vau * areaEquivalente;
            updateCurrencyDisplay('custo-destinacao', custoDestinacao);
            
            // Calcular fator social
            let fatorSocial = 0;
            if (areaTotal <= 100) fatorSocial = 20;
            else if (areaTotal <= 200) fatorSocial = 40;
            else if (areaTotal <= 300) fatorSocial = 55;
            else if (areaTotal <= 400) fatorSocial = 70;
            else fatorSocial = 90;
            
            document.getElementById('fator-social').value = `${fatorSocial}%`;
            
            // Calcular PMO
            let pmo = 0;
            if (destinacao === 'Casa Popular' || destinacao === 'Conjunto Habitacional Popular') {
                pmo = metodoConstrutivo === 'Alvenaria' ? 12 : 7;
            } else {
                pmo = metodoConstrutivo === 'Alvenaria' ? 20 : 15;
            }
            
            document.getElementById('pmo').value = `${pmo}%`;
            
            // Calcular remuneração de mão de obra total
            const remuneracaoMaoObra = custoDestinacao * (fatorSocial / 100) * (pmo / 100);
            updateCurrencyDisplay('remuneracao-mao-obra', remuneracaoMaoObra);
            
            // Calcular INSS a recolher
            const inssRecolher = remuneracaoMaoObra * 0.368;
            updateCurrencyDisplay('inss-recolher', inssRecolher);
        }
        
        // Event listener para cálculo automático de custos
        document.getElementById('vau').addEventListener('input', calculateCosts);
        
        // Cálculo do fator de ajuste (Passo 4)
        function calculateAdjustmentFactor() {
            const remuneracaoMaoObra = parseFloat(document.getElementById('remuneracao-mao-obra').value.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            const areaTotal = parseFloat(document.getElementById('area-total').value) || 0;
            
            // Exibir remuneração de mão de obra
            updateCurrencyDisplay('remuneracao-mao-obra-display', remuneracaoMaoObra);
            
            // Calcular fator de ajuste percentual
            const fatorAjustePercentual = areaTotal <= 350 ? 50 : 70;
            document.getElementById('fator-ajuste-percentual').value = `${fatorAjustePercentual}%`;
            
            // Calcular RMT para o FA
            const rmtFa = remuneracaoMaoObra * (fatorAjustePercentual / 100);
            updateCurrencyDisplay('rmt-fa', rmtFa);
            
            // Exibir fator de ajuste
            updateCurrencyDisplay('fator-ajuste-valor', remuneracaoMaoObra);
            
            // Exibir RMT para o FA
            updateCurrencyDisplay('rmt-fa-display', rmtFa);
            
            // Calcular CPP
            const cpp = rmtFa * 0.2;
            updateCurrencyDisplay('cpp', cpp);
        }
        
        // Gerar PDF
        document.getElementById('generate-pdf').addEventListener('click', function() {
            generatePDF();
        });
        
        function generatePDF() {
            const loadingElement = document.getElementById('pdf-loading');
            const { jsPDF } = window.jspdf;
            
            // Mostrar loading
            loadingElement.style.display = 'block';
            
            // Pequeno delay para garantir que o loading seja visível
            setTimeout(() => {
                try {
                    // Criar novo documento PDF
                    const doc = new jsPDF();
                    
                    // Configurações da página A4
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    const margin = 20;
                    const contentWidth = pageWidth - (2 * margin);
                    
                    // Posição inicial
                    let yPosition = margin + 20;
                    
                    // Função para adicionar linha separadora
                    const addSeparator = (y) => {
                        doc.setDrawColor(200, 200, 200);
                        doc.setLineWidth(0.5);
                        doc.line(margin, y, pageWidth - margin, y);
                        return y + 10;
                    };
                    
                    // Função para adicionar texto centralizado
                    const addCenteredText = (text, y, fontSize = 12, isBold = false) => {
                        doc.setFontSize(fontSize);
                        doc.setFont('helvetica', isBold ? 'bold' : 'normal');
                        const textWidth = doc.getTextWidth(text);
                        const x = (pageWidth - textWidth) / 2;
                        doc.text(text, x, y);
                        return y + (fontSize / 2) + 5;
                    };
                    
                    // Função para adicionar linha de informação
                    const addInfoLine = (label, value, y) => {
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'normal');
                        
                        // Label
                        doc.text(label, margin, y);
                        
                        // Value (alinhado à direita)
                        const valueWidth = doc.getTextWidth(value);
                        doc.text(value, pageWidth - margin - valueWidth, y);
                        
                        return y + 8;
                    };
                    
                    // Título principal
                    yPosition = addCenteredText('Resumo do Cálculo de INSS de Obras', yPosition, 16, true);
                    
                    yPosition += 10;
                    
                    // Data e hora
                    const now = new Date();
                    const dataHora = now.toLocaleString('pt-BR');
                    yPosition = addCenteredText(`Gerado em: ${dataHora}`, yPosition, 10, false);
                    
                    yPosition += 15;
                    
                    // Linha separadora
                    yPosition = addSeparator(yPosition);
                    
                    // Informações principais
                    const areaTotal = parseFloat(document.getElementById('area-total').value) || 0;
                    const inssSemAjuste = parseFloat(document.getElementById('inss-recolher').value.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                    const inssComAjuste = parseFloat(document.getElementById('cpp').value.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                    const diferenca = inssSemAjuste - inssComAjuste;
                    const percentualEconomia = inssSemAjuste > 0 ? (diferenca / inssSemAjuste) * 100 : 0;
                    const vau = parseFloat(document.getElementById('vau').value) || 0;
                    
                    // Adicionar informações
                    yPosition = addInfoLine('Área Construída Total:', `${areaTotal.toFixed(2)} m²`, yPosition);
                    yPosition = addInfoLine('INSS sem Fator de Ajuste:', formatCurrency(inssSemAjuste), yPosition);
                    yPosition = addInfoLine('INSS com Fator de Ajuste:', formatCurrency(inssComAjuste), yPosition);
                    yPosition = addInfoLine('Diferença:', formatCurrency(diferenca), yPosition);
                    yPosition = addInfoLine('VAU:', formatCurrency(vau), yPosition);
                    yPosition = addInfoLine('Economia:', `${percentualEconomia.toFixed(2)}%`, yPosition);
                    
                    yPosition += 10;
                    
                    // Linha separadora final
                    yPosition = addSeparator(yPosition);
                    
                    yPosition += 15;
                    
                    // Contato no rodapé
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    const contatoText = 'E-mail: contatoinssobra@gmail.com | Tel: (35) 99911-9922';
                    const contatoWidth = doc.getTextWidth(contatoText);
                    const contatoX = (pageWidth - contatoWidth) / 2;
                    doc.text(contatoText, contatoX, pageHeight - margin);
                    
                    // Salvar PDF
                    const fileName = `Resumo_INSS_Obras_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}.pdf`;
                    doc.save(fileName);
                    
                    // Esconder loading
                    loadingElement.style.display = 'none';
                    
                } catch (error) {
                    console.error('Erro ao gerar PDF:', error);
                    alert('Erro ao gerar PDF. Verifique o console para mais detalhes.');
                    loadingElement.style.display = 'none';
                }
            }, 100);
        }
    </script>
</body>
</html>
