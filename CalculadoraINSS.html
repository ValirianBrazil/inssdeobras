<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário Multistep - Cálculo de Custos</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .form-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .form-header h1 {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .form-header p {
            color: #7f8c8d;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background-color: #e0e0e0;
            transform: translateY(-50%);
            z-index: 1;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background-color: var(--primary-color);
            transform: translateY(-50%);
            z-index: 2;
            transition: var(--transition);
            width: 0%;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
            z-index: 3;
            transition: var(--transition);
        }

        .step.active {
            background-color: var(--primary-color);
        }

        .step.completed {
            background-color: var(--success-color);
        }

        .step-label {
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .step.active .step-label {
            color: var(--primary-color);
            font-weight: bold;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--secondary-color);
        }

        .required::after {
            content: ' *';
            color: var(--danger-color);
        }

        input, select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        input[readonly] {
            background-color: #f8f9fa;
            color: #6c757d;
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #7f8c8d;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #27ae60;
        }

        .external-link {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .external-link:hover {
            text-decoration: underline;
        }

        .separator {
            height: 1px;
            background-color: #e0e0e0;
            margin: 2rem 0;
        }

        .section-title {
            text-align: center;
            font-weight: bold;
            margin: 1.5rem 0;
            color: var(--secondary-color);
        }

        .contact-info {
            text-align: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e0e0e0;
            color: #7f8c8d;
        }

        .currency-input {
            position: relative;
        }

        .currency-input::before {
            content: 'R$';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }

        .currency-input input {
            padding-left: 2.5rem;
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: none;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .step-label {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-card">
            <div class="form-header">
                <h1>Cálculo de Custos de Construção</h1>
                <p>Preencha as informações abaixo para calcular os custos da sua obra</p>
            </div>

            <div class="progress-bar">
                <div class="step active" id="step1">
                    <span>1</span>
                    <div class="step-label">Destinação</div>
                </div>
                <div class="step" id="step2">
                    <span>2</span>
                    <div class="step-label">Áreas</div>
                </div>
                <div class="step" id="step3">
                    <span>3</span>
                    <div class="step-label">Custos</div>
                </div>
                <div class="step" id="step4">
                    <span>4</span>
                    <div class="step-label">Ajustes</div>
                </div>
            </div>

            <form id="multistep-form">
                <!-- Passo 1: Destinação e Método Construtivo -->
                <div class="form-step active" id="step1-form">
                    <div class="form-group">
                        <label for="destinacao" class="required">Destinação</label>
                        <select id="destinacao" name="destinacao" required>
                            <option value="">Selecione uma opção</option>
                            <option value="Unifamiliar">Unifamiliar</option>
                            <option value="Multifamiliar">Multifamiliar</option>
                            <option value="Comercial Salas e Lojas">Comercial Salas e Lojas</option>
                            <option value="Galpão Industrial">Galpão Industrial</option>
                            <option value="Conjunto Habitacional Popular">Conjunto Habitacional Popular</option>
                            <option value="Casa Popular">Casa Popular</option>
                        </select>
                        <div class="error-message" id="destinacao-error">Este campo é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label for="metodo-construtivo" class="required">Método Construtivo</label>
                        <select id="metodo-construtivo" name="metodo-construtivo" required>
                            <option value="">Selecione uma opção</option>
                            <option value="Alvenaria">Alvenaria</option>
                            <option value="Mista/Madeira">Mista/Madeira</option>
                        </select>
                        <div class="error-message" id="metodo-construtivo-error">Este campo é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label for="estado" class="required">Estado</label>
                        <select id="estado" name="estado" required>
                            <option value="">Selecione um estado</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amapá</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Ceará</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Espírito Santo</option>
                            <option value="GO">Goiás</option>
                            <option value="MA">Maranhão</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Pará</option>
                            <option value="PB">Paraíba</option>
                            <option value="PR">Paraná</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piauí</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rondônia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">São Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                        <div class="error-message" id="estado-error">Este campo é obrigatório</div>
                    </div>

                    <div class="form-actions">
                        <div></div> <!-- Espaço vazio para alinhar o botão à direita -->
                        <button type="button" class="btn btn-primary" id="next-step-1">Próximo</button>
                    </div>
                </div>

                <!-- Passo 2: Áreas -->
                <div class="form-step" id="step2-form">
                    <div class="form-group">
                        <label for="area-principal" class="required">Área Construída Principal (m²)</label>
                        <input type="number" id="area-principal" name="area-principal" min="0" step="0.01" required>
                        <div class="error-message" id="area-principal-error">Este campo é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label for="area-complementar-coberta">Área Construída Complementar Coberta (m²)</label>
                        <input type="number" id="area-complementar-coberta" name="area-complementar-coberta" min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="area-complementar-descoberta">Área Construída Complementar Descoberta (m²)</label>
                        <input type="number" id="area-complementar-descoberta" name="area-complementar-descoberta" min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="area-total">Área Construída Total (m²)</label>
                        <input type="number" id="area-total" name="area-total" readonly>
                    </div>

                    <div class="form-group">
                        <label for="percentual-equivalencia">Percentual de Equivalência (%)</label>
                        <input type="text" id="percentual-equivalencia" name="percentual-equivalencia" readonly>
                    </div>

                    <div class="form-group">
                        <label for="area-equivalente">Área Equivalente (m²)</label>
                        <input type="number" id="area-equivalente" name="area-equivalente" readonly>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="prev-step-2">Voltar</button>
                        <button type="button" class="btn btn-primary" id="next-step-2">Próximo</button>
                    </div>
                </div>

                <!-- Passo 3: Custos -->
                <div class="form-step" id="step3-form">
                    <div class="form-group">
                        <label for="vau" class="required">VAU</label>
                        <div class="currency-input">
                            <input type="number" id="vau" name="vau" min="0" step="0.01" required>
                        </div>
                        <a href="https://docs.google.com/spreadsheets/d/1W23oHNB7HQvbM7H1WI3VU8wJuwXb2bwGJFqSaHC5QUQ/edit?gid=0#gid=0" 
                           target="_blank" class="external-link">Acessar Tabela VAU</a>
                        <div class="error-message" id="vau-error">Este campo é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label for="custo-destinacao">Custo por Destinação</label>
                        <input type="text" id="custo-destinacao" name="custo-destinacao" readonly>
                    </div>

                    <div class="form-group">
                        <label for="fator-social">Fator Social (%)</label>
                        <input type="text" id="fator-social" name="fator-social" readonly>
                    </div>

                    <div class="form-group">
                        <label for="pmo">PMO (Percentual de Mão de Obra sobre o Custo da Obra) (%)</label>
                        <input type="text" id="pmo" name="pmo" readonly>
                    </div>

                    <div class="form-group">
                        <label for="remuneracao-mao-obra">Remuneração de Mão de Obra Total</label>
                        <input type="text" id="remuneracao-mao-obra" name="remuneracao-mao-obra" readonly>
                    </div>

                    <div class="form-group">
                        <label for="inss-recolher">INSS a Recolher</label>
                        <input type="text" id="inss-recolher" name="inss-recolher" readonly>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="prev-step-3">Voltar</button>
                        <button type="button" class="btn btn-primary" id="next-step-3">Próximo</button>
                    </div>
                </div>

                <!-- Passo 4: Ajustes -->
                <div class="form-step" id="step4-form">
                    <div class="section-title">Fator de Ajuste</div>

                    <div class="form-group">
                        <label for="remuneracao-mao-obra-copy">Remuneração de Mão de Obra Total</label>
                        <input type="text" id="remuneracao-mao-obra-copy" name="remuneracao-mao-obra-copy" readonly>
                    </div>

                    <div class="form-group">
                        <label for="fator-ajuste-percentual">Fator de Ajuste (%)</label>
                        <input type="text" id="fator-ajuste-percentual" name="fator-ajuste-percentual" readonly>
                    </div>

                    <div class="form-group">
                        <label for="rmt-fa">RMT Para o FA</label>
                        <input type="text" id="rmt-fa" name="rmt-fa" readonly>
                    </div>

                    <div class="separator"></div>

                    <div class="section-title">APLICAÇÃO DO FATOR DE AJUSTE</div>

                    <div class="form-group">
                        <label for="fator-ajuste">Fator de Ajuste</label>
                        <input type="text" id="fator-ajuste" name="fator-ajuste" readonly>
                    </div>

                    <div class="form-group">
                        <label for="rmt-fa-copy">RMT para o FA</label>
                        <input type="text" id="rmt-fa-copy" name="rmt-fa-copy" readonly>
                    </div>

                    <div class="form-group">
                        <label for="cpp">Contribuição Patronal Previdenciária (CPP)</label>
                        <input type="text" id="cpp" name="cpp" readonly>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="prev-step-4">Voltar</button>
                        <button type="button" class="btn btn-success" id="generate-pdf">Gerar PDF</button>
                    </div>
                </div>
            </form>

            <div class="contact-info">
                E-mail: contatoinssobra@gmail.com | Tel: 35 9 9911-9922
            </div>
        </div>
    </div>

    <script>
        // Variáveis globais
        let currentStep = 1;
        const totalSteps = 4;

        // Elementos DOM
        const stepElements = document.querySelectorAll('.step');
        const formStepElements = document.querySelectorAll('.form-step');
        const progressBar = document.querySelector('.progress-bar');

        // Função para formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Função para formatar porcentagem
        function formatPercentage(value) {
            return `${value.toFixed(2)}%`;
        }

        // Função para atualizar a barra de progresso
        function updateProgressBar() {
            const progressPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
            progressBar.style.setProperty('--progress-width', `${progressPercentage}%`);

            stepElements.forEach((step, index) => {
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        // Função para mostrar um passo específico
        function showStep(stepNumber) {
            formStepElements.forEach(step => {
                step.classList.remove('active');
            });

            const currentFormStep = document.getElementById(`step${stepNumber}-form`);
            if (currentFormStep) {
                currentFormStep.classList.add('active');
            }

            currentStep = stepNumber;
            updateProgressBar();
        }

        // Função para validar o passo atual
        function validateStep(stepNumber) {
            let isValid = true;

            if (stepNumber === 1) {
                const destinacao = document.getElementById('destinacao');
                const metodoConstrutivo = document.getElementById('metodo-construtivo');
                const estado = document.getElementById('estado');

                if (!destinacao.value) {
                    document.getElementById('destinacao-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('destinacao-error').style.display = 'none';
                }

                if (!metodoConstrutivo.value) {
                    document.getElementById('metodo-construtivo-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('metodo-construtivo-error').style.display = 'none';
                }

                if (!estado.value) {
                    document.getElementById('estado-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('estado-error').style.display = 'none';
                }
            } else if (stepNumber === 2) {
                const areaPrincipal = document.getElementById('area-principal');
                if (!areaPrincipal.value || parseFloat(areaPrincipal.value) <= 0) {
                    document.getElementById('area-principal-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('area-principal-error').style.display = 'none';
                }
            } else if (stepNumber === 3) {
                const vau = document.getElementById('vau');
                if (!vau.value || parseFloat(vau.value) <= 0) {
                    document.getElementById('vau-error').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('vau-error').style.display = 'none';
                }
            }

            return isValid;
        }

        // Função para calcular a área total
        function calculateTotalArea() {
            const areaPrincipal = parseFloat(document.getElementById('area-principal').value) || 0;
            const areaCoberta = parseFloat(document.getElementById('area-complementar-coberta').value) || 0;
            const areaDescoberta = parseFloat(document.getElementById('area-complementar-descoberta').value) || 0;
            
            const totalArea = areaPrincipal + areaCoberta + areaDescoberta;
            document.getElementById('area-total').value = totalArea.toFixed(2);
            
            return totalArea;
        }

        // Função para calcular o percentual de equivalência
        function calculateEquivalencePercentage(destinacao, totalArea) {
            let percentage = 0;
            
            switch(destinacao) {
                case 'Unifamiliar':
                    percentage = totalArea <= 1000 ? 89 : 85;
                    break;
                case 'Multifamiliar':
                    percentage = totalArea <= 1000 ? 90 : 86.5;
                    break;
                case 'Comercial Salas e Lojas':
                    percentage = totalArea <= 3000 ? 86 : 83;
                    break;
                case 'Galpão Industrial':
                    percentage = 95;
                    break;
                case 'Conjunto Habitacional Popular':
                case 'Casa Popular':
                    percentage = 98;
                    break;
                default:
                    percentage = 0;
            }
            
            document.getElementById('percentual-equivalencia').value = formatPercentage(percentage);
            return percentage;
        }

        // Função para calcular a área equivalente
        function calculateEquivalentArea(totalArea, equivalencePercentage) {
            const equivalentArea = totalArea * (equivalencePercentage / 100);
            document.getElementById('area-equivalente').value = equivalentArea.toFixed(2);
            return equivalentArea;
        }

        // Função para calcular o fator social
        function calculateSocialFactor(totalArea) {
            let factor = 0;
            
            if (totalArea <= 100) {
                factor = 20;
            } else if (totalArea <= 200) {
                factor = 40;
            } else if (totalArea <= 300) {
                factor = 55;
            } else if (totalArea <= 400) {
                factor = 70;
            } else {
                factor = 90;
            }
            
            document.getElementById('fator-social').value = formatPercentage(factor);
            return factor;
        }

        // Função para calcular o PMO
        function calculatePMO(destinacao, metodoConstrutivo) {
            let pmo = 0;
            
            if (destinacao === 'Casa Popular' || destinacao === 'Conjunto Habitacional Popular') {
                pmo = metodoConstrutivo === 'Alvenaria' ? 12 : 7;
            } else {
                pmo = metodoConstrutivo === 'Alvenaria' ? 20 : 15;
            }
            
            document.getElementById('pmo').value = formatPercentage(pmo);
            return pmo;
        }

        // Função para calcular o custo por destinação
        function calculateCostByDestination(vau, equivalentArea) {
            const cost = vau * equivalentArea;
            document.getElementById('custo-destinacao').value = formatCurrency(cost);
            return cost;
        }

        // Função para calcular a remuneração de mão de obra
        function calculateLaborRemuneration(costByDestination, socialFactor, pmo) {
            const remuneration = costByDestination * (socialFactor / 100) * (pmo / 100);
            document.getElementById('remuneracao-mao-obra').value = formatCurrency(remuneration);
            document.getElementById('remuneracao-mao-obra-copy').value = formatCurrency(remuneration);
            return remuneration;
        }

        // Função para calcular o INSS a recolher
        function calculateINSS(laborRemuneration) {
            const inss = laborRemuneration * 0.368;
            document.getElementById('inss-recolher').value = formatCurrency(inss);
            return inss;
        }

        // Função para calcular o fator de ajuste
        function calculateAdjustmentFactor(totalArea) {
            const factor = totalArea <= 350 ? 50 : 70;
            document.getElementById('fator-ajuste-percentual').value = formatPercentage(factor);
            return factor;
        }

        // Função para calcular o RMT para o FA
        function calculateRMTForFA(laborRemuneration, adjustmentFactor) {
            const rmtFA = laborRemuneration * (adjustmentFactor / 100);
            document.getElementById('rmt-fa').value = formatCurrency(rmtFA);
            document.getElementById('rmt-fa-copy').value = formatCurrency(rmtFA);
            return rmtFA;
        }

        // Função para calcular o CPP
        function calculateCPP(rmtFA) {
            const cpp = rmtFA * 0.20;
            document.getElementById('cpp').value = formatCurrency(cpp);
            return cpp;
        }

        // Função para atualizar todos os cálculos
        function updateCalculations() {
            // Passo 2
            const totalArea = calculateTotalArea();
            const destinacao = document.getElementById('destinacao').value;
            const equivalencePercentage = calculateEquivalencePercentage(destinacao, totalArea);
            calculateEquivalentArea(totalArea, equivalencePercentage);
            
            // Passo 3
            const vau = parseFloat(document.getElementById('vau').value) || 0;
            const equivalentArea = parseFloat(document.getElementById('area-equivalente').value) || 0;
            const costByDestination = calculateCostByDestination(vau, equivalentArea);
            
            const socialFactor = calculateSocialFactor(totalArea);
            const metodoConstrutivo = document.getElementById('metodo-construtivo').value;
            const pmo = calculatePMO(destinacao, metodoConstrutivo);
            
            const laborRemuneration = calculateLaborRemuneration(costByDestination, socialFactor, pmo);
            calculateINSS(laborRemuneration);
            
            // Passo 4
            const adjustmentFactor = calculateAdjustmentFactor(totalArea);
            const rmtFA = calculateRMTForFA(laborRemuneration, adjustmentFactor);
            calculateCPP(rmtFA);
            
            // Atualizar o campo Fator de Ajuste
            document.getElementById('fator-ajuste').value = formatCurrency(rmtFA);
        }

        // Função para gerar PDF
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Dados do formulário
            const destinacao = document.getElementById('destinacao').value;
            const metodoConstrutivo = document.getElementById('metodo-construtivo').value;
            const estado = document.getElementById('estado').value;
            const areaTotal = document.getElementById('area-total').value;
            const inssSemAjuste = document.getElementById('inss-recolher').value;
            const inssComAjuste = document.getElementById('cpp').value;
            const vau = document.getElementById('vau').value;
            
            // Cálculo da diferença
            const inssSemAjusteNum = parseFloat(inssSemAjuste.replace('R$', '').replace('.', '').replace(',', '.')) || 0;
            const inssComAjusteNum = parseFloat(inssComAjuste.replace('R$', '').replace('.', '').replace(',', '.')) || 0;
            const diferenca = inssSemAjusteNum - inssComAjusteNum;
            const economiaPercentual = inssSemAjusteNum > 0 ? (diferenca / inssSemAjusteNum) * 100 : 0;
            
            // Data e hora atual
            const now = new Date();
            const dataHora = now.toLocaleString('pt-BR');
            
            // Conteúdo do PDF
            doc.setFontSize(16);
            doc.text('Resumo de Cálculo de INSS de Obra', 20, 20);
            
            doc.setFontSize(12);
            doc.text(`Data e Hora: ${dataHora}`, 20, 40);
            doc.text(`Destinação: ${destinacao}`, 20, 50);
            doc.text(`Método Construtivo: ${metodoConstrutivo}`, 20, 60);
            doc.text(`Estado: ${estado}`, 20, 70);
            doc.text(`Área Construída Total: ${areaTotal} m²`, 20, 80);
            doc.text(`INSS sem o Fator de Ajuste: ${inssSemAjuste}`, 20, 90);
            doc.text(`INSS com o Fator de Ajuste: ${inssComAjuste}`, 20, 100);
            doc.text(`Diferença: ${formatCurrency(diferenca)}`, 20, 110);
            doc.text(`VAU: R$ ${vau}`, 20, 120);
            doc.text(`Economia: ${economiaPercentual.toFixed(2)}%`, 20, 130);
            
            doc.text('Contato:', 20, 150);
            doc.text('E-mail: contatoinssobra@gmail.com', 20, 160);
            doc.text('Tel: 35 9 9911-9922', 20, 170);
            
            // Salvar o PDF
            doc.save(`relatorio-custos-${now.getTime()}.pdf`);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navegação entre passos
            document.getElementById('next-step-1').addEventListener('click', function() {
                if (validateStep(1)) {
                    showStep(2);
                    updateCalculations();
                }
            });
            
            document.getElementById('prev-step-2').addEventListener('click', function() {
                showStep(1);
            });
            
            document.getElementById('next-step-2').addEventListener('click', function() {
                if (validateStep(2)) {
                    showStep(3);
                    updateCalculations();
                }
            });
            
            document.getElementById('prev-step-3').addEventListener('click', function() {
                showStep(2);
            });
            
            document.getElementById('next-step-3').addEventListener('click', function() {
                if (validateStep(3)) {
                    showStep(4);
                    updateCalculations();
                }
            });
            
            document.getElementById('prev-step-4').addEventListener('click', function() {
                showStep(3);
            });
            
            // Atualizar cálculos quando os campos de área mudam
            document.getElementById('area-principal').addEventListener('input', updateCalculations);
            document.getElementById('area-complementar-coberta').addEventListener('input', updateCalculations);
            document.getElementById('area-complementar-descoberta').addEventListener('input', updateCalculations);
            document.getElementById('vau').addEventListener('input', updateCalculations);
            
            // Gerar PDF
            document.getElementById('generate-pdf').addEventListener('click', generatePDF);
        });
    </script>
</body>
</html>
